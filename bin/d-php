#!/bin/bash

version=php:7.4-fpm-alpine
for arg in "$@"; do
	if [ "$arg" = "8.0" ]
	then
		version=php:8.0-fpm-alpine
	fi
done

docker network create web-containers 2> /dev/null;

if service --status-all | grep -Fq 'apache2';
then
	echo 'Stoping apache2 on the computer ...';
	sudo service apache2 stop;
fi

if service --status-all | grep -Fq 'nginx';
then
	echo 'Stoping nginx on the computer ...';
	sudo service nginx stop;
fi

docker build \
	-t web-php \
	--build-arg VERSION=$version \
	./php

docker run \
	-d \
	--rm \
	--name php \
	--network web-containers \
	-v ${PWD}/build:/script:ro \
	web-php